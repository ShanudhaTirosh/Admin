<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Data Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 400px;
            width: 100%;
            padding: 2rem;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 20px;
            padding: 2rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .navbar {
            background: var(--primary-color) !important;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .search-container {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: white;
        }

        .search-input {
            border: none;
            border-radius: 25px;
            padding: 0.75rem 1.5rem;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .random-records {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: all 0.5s ease;
        }

        .random-records.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }

        .table-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .table {
            border-radius: 10px;
            overflow: hidden;
        }

        .table thead {
            background: var(--primary-color);
            color: white;
        }

        .btn-action {
            margin: 0 2px;
            padding: 0.375rem 0.75rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background: var(--primary-color);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .random-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .random-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                padding: 1rem;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
            
            .btn-action {
                padding: 0.25rem 0.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading...</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="text-center mb-4">
                <i class="fas fa-graduation-cap fa-3x text-primary mb-3"></i>
                <h2>Student Management System</h2>
                <p class="text-muted">Please login to continue</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">
                    <i class="fas fa-sign-in-alt me-2"></i>Login
                </button>
            </form>
            
            <div class="text-center">
                <small class="text-muted">Don't have an account? 
                    <a href="#" id="showRegister">Register here</a>
                </small>
            </div>
            
            <div id="registerForm" class="hidden mt-3">
                <hr>
                <h5>Create Account</h5>
                <form id="signupForm">
                    <div class="mb-3">
                        <label for="regEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="regEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="regPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="regPassword" required>
                    </div>
                    <button type="submit" class="btn btn-success w-100">
                        <i class="fas fa-user-plus me-2"></i>Create Account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="main-container hidden" id="dashboard">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <span class="navbar-brand">
                    <i class="fas fa-graduation-cap me-2"></i>
                    Student Management
                </span>
                <div class="navbar-nav ms-auto">
                    <span class="navbar-text me-3" id="userEmail"></span>
                    <button class="btn btn-outline-light" id="logoutBtn">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Search Section -->
        <div class="search-container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-0">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" class="form-control search-input border-start-0" 
                               id="searchInput" placeholder="Search students by name, admission number, class...">
                    </div>
                </div>
                <div class="col-lg-4 text-end mt-3 mt-lg-0">
                    <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                        <i class="fas fa-user-plus me-2"></i>Add Student
                    </button>
                </div>
            </div>
        </div>

        <!-- Random Records Section -->
        <div class="random-records" id="randomRecords">
            <h4 class="mb-3">
                <i class="fas fa-dice me-2"></i>Random Student Records
            </h4>
            <div id="randomStudents" class="row">
                <!-- Random students will be populated here -->
            </div>
        </div>

        <!-- Students Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4><i class="fas fa-users me-2"></i>All Students</h4>
                <button class="btn btn-outline-primary" id="refreshBtn">
                    <i class="fas fa-sync-alt me-2"></i>Refresh
                </button>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Admission No.</th>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Class</th>
                            <th>Gender</th>
                            <th>Contact</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Students data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal fade" id="addStudentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-plus me-2"></i>Add New Student
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addStudentForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="admissionNo" class="form-label">Admission Number</label>
                                <input type="text" class="form-control" id="admissionNo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="studentName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="studentName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="age" class="form-label">Age</label>
                                <input type="number" class="form-control" id="age" min="1" max="100" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="class" class="form-label">Class</label>
                                <input type="text" class="form-control" id="class" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="gender" class="form-label">Gender</label>
                                <select class="form-control" id="gender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="contact" class="form-label">Contact Number</label>
                                <input type="tel" class="form-control" id="contact">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="studentEmail">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Address</label>
                            <textarea class="form-control" id="address" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="saveStudentBtn">
                        <i class="fas fa-save me-2"></i>Save Student
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal fade" id="editStudentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-edit me-2"></i>Edit Student
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editStudentForm">
                        <input type="hidden" id="editRowIndex">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editAdmissionNo" class="form-label">Admission Number</label>
                                <input type="text" class="form-control" id="editAdmissionNo" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editStudentName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="editStudentName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="editAge" class="form-label">Age</label>
                                <input type="number" class="form-control" id="editAge" min="1" max="100" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editClass" class="form-label">Class</label>
                                <input type="text" class="form-control" id="editClass" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editGender" class="form-label">Gender</label>
                                <select class="form-control" id="editGender" required>
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editContact" class="form-label">Contact Number</label>
                                <input type="tel" class="form-control" id="editContact">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="editStudentEmail">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="editAddress" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateStudentBtn">
                        <i class="fas fa-save me-2"></i>Update Student
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this student record?</p>
                    <p><strong>Student:</strong> <span id="deleteStudentName"></span></p>
                    <p><strong>Admission No:</strong> <span id="deleteAdmissionNo"></span></p>
                    <p class="text-danger"><strong>This action cannot be undone!</strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="fas fa-trash me-2"></i>Delete Student
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

        // Firebase configuration - REPLACE WITH YOUR CONFIG
        const firebaseConfig = {
  apiKey: "AIzaSyB8b33edlM77dGeukt56dj3ArOTqRrajOM",
  authDomain: "school-3df26.firebaseapp.com",
  projectId: "school-3df26",
  storageBucket: "school-3df26.firebasestorage.app",
  messagingSenderId: "385586725492",
  appId: "1:385586725492:web:32be50015700c2fd70c721"
};

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Global variables
        let studentsData = [];
        let filteredData = [];
        let currentUser = null;

        // Google Apps Script Web App URL - REPLACE WITH YOUR DEPLOYED URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxTsbA15SUi48bnwGDwrDMw0GWSzs3QkXX9WdWrdPQvP1VFcc9aegXSG2I-NlcJlTo5vA/exec';

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const showRegisterLink = document.getElementById('showRegister');
        const registerForm = document.getElementById('registerForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const userEmail = document.getElementById('userEmail');
        const searchInput = document.getElementById('searchInput');
        const randomRecords = document.getElementById('randomRecords');
        const studentsTableBody = document.getElementById('studentsTableBody');
        const refreshBtn = document.getElementById('refreshBtn');
        const saveStudentBtn = document.getElementById('saveStudentBtn');
        const updateStudentBtn = document.getElementById('updateStudentBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                userEmail.textContent = user.email;
                showDashboard();
                loadStudents();
            } else {
                currentUser = null;
                showLogin();
            }
        });

        // Show/Hide screens
        function showLogin() {
            loginScreen.classList.remove('hidden');
            dashboard.classList.add('hidden');
        }

        function showDashboard() {
            loginScreen.classList.add('hidden');
            dashboard.classList.remove('hidden');
        }

        function showLoading() {
            loadingSpinner.style.display = 'block';
        }

        function hideLoading() {
            loadingSpinner.style.display = 'none';
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Authentication functions
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showToast('Login successful!');
            } catch (error) {
                showToast(error.message, 'danger');
            } finally {
                hideLoading();
            }
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showToast('Account created successfully!');
                registerForm.classList.add('hidden');
            } catch (error) {
                showToast(error.message, 'danger');
            } finally {
                hideLoading();
            }
        });

        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.toggle('hidden');
        });

        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                showToast('Logged out successfully!');
            } catch (error) {
                showToast(error.message, 'danger');
            }
        });

        // Google Sheets API functions
        async function makeAPICall(action, data = {}) {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action, ...data })
                });
                
                const result = await response.json();
                if (result.error) {
                    throw new Error(result.error);
                }
                return result;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function loadStudents() {
            showLoading();
            try {
                const result = await makeAPICall('getStudents');
                studentsData = result.data || [];
                filteredData = [...studentsData];
                displayStudents();
                displayRandomStudents();
                showToast(`Loaded ${studentsData.length} students`);
            } catch (error) {
                showToast('Error loading students: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        }

        function displayStudents(data = filteredData) {
            const tbody = studentsTableBody;
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="fas fa-user-slash fa-2x mb-2"></i>
                            <p>No students found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            data.forEach((student, index) => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                row.innerHTML = `
                    <td><strong>${student.admissionNo || 'N/A'}</strong></td>
                    <td>${student.name || 'N/A'}</td>
                    <td>${student.age || 'N/A'}</td>
                    <td>${student.class || 'N/A'}</td>
                    <td>
                        <span class="badge bg-${student.gender === 'Male' ? 'primary' : student.gender === 'Female' ? 'info' : 'secondary'}">
                            ${student.gender || 'N/A'}
                        </span>
                    </td>
                    <td>${student.contact || 'N/A'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-action" onclick="editStudent(${student.rowIndex || index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger btn-action" onclick="deleteStudent(${student.rowIndex || index}, '${student.name}', '${student.admissionNo}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayRandomStudents() {
            const randomContainer = document.getElementById('randomStudents');
            randomContainer.innerHTML = '';

            if (studentsData.length === 0) return;

            const randomStudents = getRandomStudents(3);
            randomStudents.forEach(student => {
                const card = document.createElement('div');
                card.className = 'col-md-4 mb-3';
                card.innerHTML = `
                    <div class="random-card">
                        <h6 class="mb-2">
                            <i class="fas fa-user me-2"></i>${student.name || 'N/A'}
                        </h6>
                        <p class="mb-1"><strong>Admission:</strong> ${student.admissionNo || 'N/A'}</p>
                        <p class="mb-1"><strong>Class:</strong> ${student.class || 'N/A'}</p>
                        <p class="mb-0"><strong>Gender:</strong> ${student.gender || 'N/A'}</p>
                    </div>
                `;
                randomContainer.appendChild(card);
            });
        }

        function getRandomStudents(count) {
            const shuffled = [...studentsData].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                filteredData = [...studentsData];
                randomRecords.classList.remove('fade-out');
                randomRecords.style.display = 'block';
            } else {
                filteredData = studentsData.filter(student => 
                    (student.name && student.name.toLowerCase().includes(searchTerm)) ||
                    (student.admissionNo && student.admissionNo.toLowerCase().includes(searchTerm)) ||
                    (student.class && student.class.toLowerCase().includes(searchTerm)) ||
                    (student.gender && student.gender.toLowerCase().includes(searchTerm))
                );
                
                randomRecords.classList.add('fade-out');
                setTimeout(() => {
                    randomRecords.style.display = 'none';
                }, 500);
            }
            
            displayStudents();
        });

        // Add student functionality
        saveStudentBtn.addEventListener('click', async () => {
            const formData = {
                admissionNo: document.getElementById('admissionNo').value,
                name: document.getElementById('studentName').value,
                age: document.getElementById('age').value,
                class: document.getElementById('class').value,
                gender: document.getElementById('gender').value,
                contact: document.getElementById('contact').value,
                email: document.getElementById('studentEmail').value,
                address: document.getElementById('address').value
            };

            if (!formData.admissionNo || !formData.name || !formData.age || !formData.class || !formData.gender) {
                showToast('Please fill in all required fields', 'danger');
                return;
            }

            showLoading();
            try {
                await makeAPICall('addStudent', formData);
                showToast('Student added successfully!');
                document.getElementById('addStudentForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addStudentModal')).hide();
                loadStudents();
            } catch (error) {
                showToast('Error adding student: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        });

        // Edit student functionality
        window.editStudent = function(rowIndex) {
            const student = studentsData.find(s => s.rowIndex === rowIndex) || studentsData[rowIndex];
            if (!student) return;

            document.getElementById('editRowIndex').value = rowIndex;
            document.getElementById('editAdmissionNo').value = student.admissionNo || '';
            document.getElementById('editStudentName').value = student.name || '';
            document.getElementById('editAge').value = student.age || '';
            document.getElementById('editClass').value = student.class || '';
            document.getElementById('editGender').value = student.gender || '';
            document.getElementById('editContact').value = student.contact || '';
            document.getElementById('editStudentEmail').value = student.email || '';
            document.getElementById('editAddress').value = student.address || '';

            new bootstrap.Modal(document.getElementById('editStudentModal')).show();
        };

        updateStudentBtn.addEventListener('click', async () => {
            const rowIndex = document.getElementById('editRowIndex').value;
            const formData = {
                rowIndex: parseInt(rowIndex),
                admissionNo: document.getElementById('editAdmissionNo').value,
                name: document.getElementById('editStudentName').value,
                age: document.getElementById('editAge').value,
                class: document.getElementById('editClass').value,
                gender: document.getElementById('editGender').value,
                contact: document.getElementById('editContact').value,
                email: document.getElementById('editStudentEmail').value,
                address: document.getElementById('editAddress').value
            };

            if (!formData.admissionNo || !formData.name || !formData.age || !formData.class || !formData.gender) {
                showToast('Please fill in all required fields', 'danger');
                return;
            }

            showLoading();
            try {
                await makeAPICall('updateStudent', formData);
                showToast('Student updated successfully!');
                bootstrap.Modal.getInstance(document.getElementById('editStudentModal')).hide();
                loadStudents();
            } catch (error) {
                showToast('Error updating student: ' + error.message, 'danger');
            } finally {
                hideLoading();
            }
        });

        // Delete student functionality
        let deleteRowIndex = null;

        window.deleteStudent = function(rowIndex, name, admissionNo) {
            deleteRowIndex = rowIndex;
            document.getElementById('deleteStudentName').textContent = name;
            document.getElementById('deleteAdmissionNo').textContent = admissionNo;
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        };

        confirmDeleteBtn.addEventListener('click', async () => {
            if (deleteRowIndex === null) return;

            showLoading();
            try {
                await makeAPICall('deleteStudent', { rowIndex: deleteRowIndex });
                showToast('Student deleted successfully!');
                bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
                loadStudents();
            } catch (error) {
                showToast('Error deleting student: ' + error.message, 'danger');
            } finally {
                hideLoading();
                deleteRowIndex = null;
            }
        });

        // Refresh functionality
        refreshBtn.addEventListener('click', () => {
            loadStudents();
        });

        // Make functions globally available
        window.editStudent = editStudent;
        window.deleteStudent = deleteStudent;
    </script>
</body>
</html>